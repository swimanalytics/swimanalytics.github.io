<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test Google Analytics - Network Check</title>
</head>
<body>
    <h1>Google Analytics Network Debugging</h1>

    <div id="status"></div>
    <h2>Script Loading Status:</h2>
    <pre id="scripts"></pre>
    <h2>Network Requests (check DevTools ‚Üí Network):</h2>
    <ul id="network"></ul>

    <script>
        function updateStatus() {
            const consent = localStorage.getItem('cookieConsent');
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `
                <p><strong>Cookie Consent:</strong> ${consent || 'NOT SET'}</p>
                <p><strong>GA ID configured:</strong> G-558XX0CFBT</p>
            `;

            // Check if gtag.js script was added
            const scriptsDiv = document.getElementById('scripts');
            const allScripts = Array.from(document.querySelectorAll('script'));
            scriptsDiv.textContent = 'Scripts on page:\n';
            allScripts.forEach(s => {
                scriptsDiv.textContent += `- ${s.src || '(inline)'}\n`;
            });

            // List what we expect
            const networkDiv = document.getElementById('network');
            networkDiv.innerHTML = `
                <li>Expected: <code>https://www.googletagmanager.com/gtag/js?id=G-558XX0CFBT</code></li>
                <li>Check DevTools ‚Üí Network tab to see if this loaded</li>
                <li>If it shows <strong style="color:red">Failed</strong> or <strong style="color:red">Blocked</strong>, that's the problem!</li>
            `;
        }

        // Set consent before loading analytics
        localStorage.setItem('cookieConsent', 'accepted');
        localStorage.setItem('cookieConsentTimestamp', Date.now().toString());

        updateStatus();

        // Monitor script loading
        const observer = new MutationObserver(() => {
            setTimeout(updateStatus, 100);
        });
        observer.observe(document.documentElement, { childList: true, subtree: true });
    </script>

    <!-- Load analytics -->
    <script src="/assets/js/analytics.min.js" data-ga-id="G-558XX0CFBT"></script>

    <script>
        // After 2 seconds, check if gtag loaded
        setTimeout(() => {
            const gtagScript = document.querySelector('script[src*="googletagmanager.com"]');
            if (gtagScript) {
                console.log('‚úÖ gtag.js script element was added to DOM');
                console.log('üìç Script src:', gtagScript.src);
            } else {
                console.error('‚ùå gtag.js script was NOT added to DOM');
            }

            if (typeof window.gtag !== 'undefined') {
                console.log('‚úÖ window.gtag function exists');
            } else {
                console.error('‚ùå window.gtag does NOT exist');
            }

            if (typeof window.dataLayer !== 'undefined') {
                console.log('‚úÖ window.dataLayer exists:', window.dataLayer);
            } else {
                console.error('‚ùå window.dataLayer does NOT exist');
            }
        }, 2000);
    </script>
</body>
</html>
