(function(){'use strict';const consentGiven=localStorage.getItem('cookieConsent')==='accepted';if(!consentGiven){console.log('Analytics: Waiting for cookie consent');return;}
const scriptTag=document.querySelector('script[data-ga-id]');const gaId=scriptTag?scriptTag.getAttribute('data-ga-id'):null;if(!gaId||gaId==='G-XXXXXXXXXX'){console.log('Analytics: No valid GA ID configured');return;}
console.log('Analytics: Loading with consent');const script=document.createElement('script');script.async=true;const gtagUrl='https://www.googletagmanager.com/gtag/js?id='+gaId;script.src=gtagUrl;console.log('Analytics: Script URL:',gtagUrl);script.onload=function(){console.log('Analytics: gtag.js loaded successfully');};script.onerror=function(){console.error('Analytics: Failed to load gtag.js');};document.head.appendChild(script);console.log('Analytics: Script element added to DOM');window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config',gaId,{'anonymize_ip':true,'cookie_flags':'SameSite=None;Secure'});window.gtag=gtag;window.trackEvent=function(category,action,label,value){if(window.gtag){gtag('event',action,{'event_category':category,'event_label':label,'value':value});}};document.addEventListener('click',function(e){const link=e.target.closest('a');if(link&&link.hostname!==window.location.hostname){if(window.gtag){gtag('event','click',{'event_category':'outbound','event_label':link.href});}}});window.addEventListener('storage',function(e){if(e.key==='cookieConsent'){if(e.newValue==='declined'||e.newValue===null){const cookies=document.cookie.split(';');cookies.forEach(cookie=>{const name=cookie.split('=')[0].trim();if(name.startsWith('_ga')||name.startsWith('_gid')){document.cookie=name+'=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/';}});console.log('Analytics: Cookies cleared due to consent withdrawal');}}});})();