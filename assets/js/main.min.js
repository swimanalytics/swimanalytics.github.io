(function(){'use strict';const menuToggle=document.getElementById('menu-toggle');const navPrimary=document.getElementById('nav-primary');if(menuToggle&&navPrimary){menuToggle.addEventListener('click',function(){const isOpen=navPrimary.classList.toggle('is-open');menuToggle.classList.toggle('is-open');menuToggle.setAttribute('aria-expanded',isOpen);});const navLinks=navPrimary.querySelectorAll('a');navLinks.forEach(link=>{link.addEventListener('click',function(){navPrimary.classList.remove('is-open');menuToggle.classList.remove('is-open');menuToggle.setAttribute('aria-expanded','false');});});document.addEventListener('click',function(event){if(!menuToggle.contains(event.target)&&!navPrimary.contains(event.target)){navPrimary.classList.remove('is-open');menuToggle.classList.remove('is-open');menuToggle.setAttribute('aria-expanded','false');}});}
const languageSelect=document.getElementById('language-select');if(languageSelect){languageSelect.addEventListener('change',function(){const newLang=this.value;const currentPath=window.location.pathname;const pathParts=currentPath.split('/').filter(part=>part);const currentLang=pathParts[0];let newPath=currentPath.replace('/'+currentLang+'/','/'+newLang+'/');window.location.href=newPath;});}
const currentPath=window.location.pathname;const navLinks=document.querySelectorAll('.nav-primary a');navLinks.forEach(link=>{if(link.getAttribute('href')===currentPath||link.getAttribute('href')+'/'===currentPath||link.getAttribute('href')===currentPath+'/'){link.classList.add('active');link.setAttribute('aria-current','page');}});document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener('click',function(e){const href=this.getAttribute('href');if(href!=='#'&&href!==''){e.preventDefault();const target=document.querySelector(href);if(target){target.scrollIntoView({behavior:'smooth',block:'start'});}}});});const contactForm=document.getElementById('contact-form');if(contactForm){const statusDiv=document.getElementById('form-status');const submitButton=contactForm.querySelector('button[type="submit"]');const originalButtonText=submitButton?submitButton.textContent:'';const langInput=contactForm.querySelector('input[name="language"]');const lang=langInput?langInput.value:'en';const messages={en:{sending:'Sending...',success:'Message sent successfully! We\'ll get back to you soon.',error:'Error sending message. Please try again or contact us via email.',required:'This field is required',invalidEmail:'Please enter a valid email address'},ca:{sending:'Enviant...',success:'Missatge enviat correctament! Ens posarem en contacte aviat.',error:'Error enviant el missatge. Si us plau, torna-ho a provar o contacta\'ns per email.',required:'Aquest camp és obligatori',invalidEmail:'Si us plau, introdueix un email vàlid'}};const msg=messages[lang]||messages.en;contactForm.addEventListener('submit',async function(e){e.preventDefault();let isValid=true;const requiredFields=this.querySelectorAll('[required]');requiredFields.forEach(field=>{const errorSpan=document.getElementById(field.id+'-error');if(!field.value.trim()){isValid=false;field.classList.add('error');if(errorSpan){errorSpan.textContent=msg.required;}}else{field.classList.remove('error');if(errorSpan){errorSpan.textContent='';}}});const emailField=this.querySelector('[type="email"]');if(emailField&&emailField.value){const emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;const errorSpan=document.getElementById(emailField.id+'-error');if(!emailRegex.test(emailField.value)){isValid=false;emailField.classList.add('error');if(errorSpan){errorSpan.textContent=msg.invalidEmail;}}}
if(!isValid){return;}
if(submitButton){submitButton.disabled=true;submitButton.textContent=msg.sending;}
const formData=new FormData(this);try{const response=await fetch('https://api.web3forms.com/submit',{method:'POST',body:formData});const data=await response.json();if(response.ok&&data.success){const currentPath=window.location.pathname;const pathParts=currentPath.split('/').filter(part=>part);const currentLang=pathParts[0]||lang;window.location.href='/'+currentLang+'/thanks/';}else{statusDiv.textContent=msg.error;statusDiv.className='form-status error';}}catch(error){statusDiv.textContent=msg.error;statusDiv.className='form-status error';}finally{if(submitButton){submitButton.disabled=false;submitButton.textContent=originalButtonText;}}});}
window.addEventListener('beforeprint',function(){document.body.classList.add('is-printing');});window.addEventListener('afterprint',function(){document.body.classList.remove('is-printing');});function initSplashScreen(){const isHomepage=currentPath==='/'||currentPath.match(/^\/(ca|en)\/?$/);if(!isHomepage){return;}
const splashShown=sessionStorage.getItem('splashShown');if(splashShown){return;}
sessionStorage.setItem('splashShown','true');document.body.classList.add('splash-active');const splashScreen=document.createElement('div');splashScreen.className='splash-screen';splashScreen.innerHTML=`<div class="splash-logo"><img src="/assets/images/logo.png"alt="SwimAnalytics"width="200"height="200"><div class="splash-logo-text">SwimAnalytics</div></div>`;document.body.insertBefore(splashScreen,document.body.firstChild);setTimeout(function(){document.body.classList.remove('splash-active');const header=document.querySelector('.site-header');const mainContent=document.querySelector('.main-content');if(header){header.classList.add('content-reveal');}
if(mainContent){mainContent.classList.add('content-reveal');}
setTimeout(function(){if(splashScreen&&splashScreen.parentNode){splashScreen.parentNode.removeChild(splashScreen);}},600);},2800);}
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initSplashScreen);}else{initSplashScreen();}
function initThemeToggle(){const themeToggle=document.getElementById('theme-toggle');if(!themeToggle)return;const savedTheme=localStorage.getItem('theme');const prefersDark=window.matchMedia('(prefers-color-scheme: dark)').matches;if(savedTheme==='dark'||(!savedTheme&&prefersDark)){document.documentElement.classList.add('dark-mode');}else{document.documentElement.classList.remove('dark-mode');}
themeToggle.addEventListener('click',function(){const isDark=document.documentElement.classList.toggle('dark-mode');localStorage.setItem('theme',isDark?'dark':'light');this.setAttribute('aria-label',isDark?'Switch to light mode':'Switch to dark mode');});const isDark=document.documentElement.classList.contains('dark-mode');themeToggle.setAttribute('aria-label',isDark?'Switch to light mode':'Switch to dark mode');}
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initThemeToggle);}else{initThemeToggle();}
function initAppBanner(){const banner=document.getElementById('app-download-banner');const dismissBtn=document.getElementById('dismiss-app-banner');if(!banner||!dismissBtn)return;const isDismissed=localStorage.getItem('appBannerDismissed')==='true';if(isDismissed){banner.classList.add('hidden');document.body.classList.add('banner-dismissed');}else{setTimeout(()=>{banner.classList.remove('hidden');document.body.classList.remove('banner-dismissed');},500);}
dismissBtn.addEventListener('click',function(){banner.classList.add('hidden');document.body.classList.add('banner-dismissed');localStorage.setItem('appBannerDismissed','true');});}
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initAppBanner);}else{initAppBanner();}})();